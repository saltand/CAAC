<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React with Local Components</title>
  </head>
  <body>
    <div id="root"></div>

    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Load local packages as scripts -->
    <script>
      // Mock React and ReactDOM for ES modules
      window.process = { env: { NODE_ENV: 'production' } };
    </script>
    
    <!-- Load shared package first -->
    <script type="module">
      // Load shared package
      import * as shared from '../packages/shared/dist/index.js';
      window.CAACSHared = shared;
      
      // Create a simple CatImage component that works in browser
      const { useState, useEffect, createElement: e } = React;
      
      function CatImage({ width = 300, height = 300, className, style }) {
        const [imageUrl, setImageUrl] = useState('');
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(false);

        const loadCatImage = async () => {
          setLoading(true);
          setError(false);
          
          try {
            const result = await window.CAACSHared.fetchCatImage();
            
            if (result.error || !result.data) {
              setError(true);
            } else {
              setImageUrl(result.data.url);
            }
          } catch (err) {
            setError(true);
          } finally {
            setLoading(false);
          }
        };

        useEffect(() => {
          if (typeof window !== 'undefined') {
            loadCatImage();
          }
        }, []);

        const containerStyle = {
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          width: width,
          height: height,
          borderRadius: '8px',
          overflow: 'hidden',
          border: '1px solid #e1e5e9',
          backgroundColor: '#f8f9fa',
          ...style
        };

        const imageStyle = {
          width: '100%',
          height: '100%',
          objectFit: 'cover',
          display: 'block'
        };

        const placeholderStyle = {
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          width: '100%',
          height: '100%',
          color: '#6c757d',
          fontSize: '14px',
          textAlign: 'center',
          padding: '16px'
        };

        const errorStyle = {
          ...placeholderStyle,
          color: '#dc3545'
        };

        return e('div', { className, style: containerStyle },
          loading ? 
            e('div', { style: placeholderStyle }, 'Loading cat...') :
          error ? 
            e('div', { style: errorStyle }, 'Failed to load cat image') :
            e('img', {
              src: imageUrl,
              alt: 'Random cat',
              style: imageStyle
            })
        );
      }

      function App() {
        return e('div', { 
          style: { padding: '20px', fontFamily: 'Arial, sans-serif' } 
        }, 
          e('h1', null, 'React with Local Components'),
          e('p', null, 'This page uses local CAAC React components:'),
          e('div', { style: { margin: '20px 0' } },
            e(CatImage, { width: 400, height: 300 })
          ),
          e('p', null, 'The CatImage component is loaded from the local @caac/shared package.')
        );
      }

      ReactDOM.render(e(App), document.getElementById('root'));
    </script>
  </body>
</html>
